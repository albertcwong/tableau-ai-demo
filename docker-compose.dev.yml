# Development overrides - use with: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
# Hot reload enabled; source code mounted as volumes

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    environment:
      - LOG_DIR=/app/logs
    volumes:
      - ./backend/app:/app/app
      - ./backend/mcp_server:/app/mcp_server
      - ./backend/alembic:/app/alembic
      - ./credentials:/app/credentials:ro
      - ./backend/mcp_server/credentials:/app/mcp_server/credentials
      - ./logs:/app/logs

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    environment:
      - NODE_ENV=development
      - HOSTNAME=0.0.0.0
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:8000}
      - BACKEND_API_URL=http://backend:8000
      - APP_BASE_URL=${APP_BASE_URL:-https://localhost:3000}
      - AUTH0_BASE_URL=${AUTH0_BASE_URL:-https://localhost:3000}
      - AUTH0_SECRET=${AUTH0_SECRET:-}
    healthcheck:
      test: ["CMD", "node", "-e", "require('https').get('https://localhost:3000', {rejectUnauthorized:false}, (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
      - ./frontend/localhost-key.pem:/app/localhost-key.pem:ro
      - ./frontend/localhost.pem:/app/localhost.pem:ro

volumes:
  frontend_node_modules:
